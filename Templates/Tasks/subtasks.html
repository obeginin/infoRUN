<!-- Templates/Tasks/subtasks.html
Вывод списка задач одной категории по id
/tasks/{id}
-->
{% extends "base.html" %}

{% block title %}Категория №{% endblock %}
{% block title_1 %}{% endblock %}
{% block content %}

    <a href="#" id="back-button" class="back-link">⬅ Вернуться к списку</a>
    <div id="subtask-list"></div>
{% endblock %}
 {% block extra_scripts %}
    <script>


        // Получаем task_id из URL (например, /tasks/3 - берется тройка)
        const urlParts = window.location.pathname.split("/");
        const taskId = urlParts[urlParts.length - 1];
        console.log("taskId", taskId); //Вывод в консоль браузера


        // вызываем функцию loadSubtasks() -список задач в выбранной категории
        document.addEventListener("DOMContentLoaded", () => {
            loadSubtasks(taskId)

        });




        // загружаем подзадачи
        async function loadSubTask() {
            try {
                const response = await fetch(`/subtasks/api/TaskID/${taskId}`);
                const subtasks = await response.json();

                console.log("subtasks", subtasks);

                const list = document.getElementById("subtask-list");
                subtasks.forEach(subtask => {
                    const li = document.createElement("li");
                    console.log("subtask", subtask);
                    li.innerHTML = `
                        <strong>${subtask.SubTaskNumber}</strong>: <a href="/subtasks/${subtask.SubTaskID}">${subtask.Description}</a>`;

                    list.appendChild(li);
                });
            } catch (err) {
                console.error("Ошибка при загрузке подзадач", err);
            }
        }





    </script>
{% endblock %}