<!-- Templates/Students/StudentTask.html -->
{% extends "base.html" %}

{% block title %}Список категорий{% endblock %}
{% block title_1 %}Задачи студента: {{ tasks[0].Login }}{% endblock %}
{% block content %}
<style>
        .back-button {
            display: inline-block;

            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .back-button:hover {
            background-color: #0056b3;
        }
</style>
    <form method="get" action="/students_subtasks/StudentTasksByLogin/">
        {% if student.Role == "admin" %}
          <label>Студент:</label>
          <select name="StudentID" id="select-student">
            <!-- Эта опция disabled, поэтому не попадёт в запрос -->
            <option value="" disabled selected>-- выбери студента --</option>
            {% for _student in students_id %}
              <option value="{{ _student.ID }}">{{ _student.Login }}</option>
            {% endfor %}
          </select>
        {% endif %}
        <label>Статус:</label>
        <select name="status">
            <option value="" disabled selected>-- любой --</option>
            <option value="Не приступал">Не приступал</option>
            <option value="В процессе">В процессе</option>
            <option value="Выполнено">Выполнено</option>
        </select>

        <label>Категория:</label>
        <select name="TaskID" id="select-task">
          <!-- «– любой –» будем делать disabled+selected, чтобы пустоту не отправлять -->
          <option value="" disabled selected>-- любой --</option>
          {% for (tid, title) in TasksID %}
            <option value="{{ tid }}">{{ title }}</option>
          {% endfor %}
        </select>

        <label>Вариант:</label>
        <select name="variant">
          <!-- «– любой –» будем делать disabled+selected, чтобы пустоту не отправлять -->
          <option value="" disabled selected>-- любой --</option>
          {% for var in variants %}
            <option value="{{ var[0] }}">{{ var[0] }}</option>
          {% endfor %}
        </select>

        <label>Сортировать по:</label>
        <select name="SortColumn">
            <option value="StudentTaskID">Мои задачи</option>
            {% if student.Role == "admin" %}
                <option value="Login">Логин</option>
            {% endif %}
            <option value="CompletionDate">Статус Выполнения</option>
            <option value="TaskID">Категория</option>
            <!-- Добавь другие поля, если нужно -->
        </select>

        <label>Порядок:</label>
        <select name="SortDirection">
            <option value="ASC">По возрастанию</option>
            <option value="DESC">По убыванию</option>
        </select>
        <button type="submit">Показать</button>
        <!-- Кнопка-ссылка для сброса всех фильтров -->
      <a href="/students_subtasks/StudentTasksByLogin/" style="margin-left: 1em; text-decoration: none;">
        <button type="button">Сбросить фильтры</button>
      </a>
    </form>
    <a href="/students/List/" class="back-button">Назад к списку</a>
    <ul id="task-list"></ul>

    <script>


        const tasks = {{ tasks | tojson }};
        //console.log('StudentTaskID:', StudentTaskID);
        //console.log('tasks:', tasks.StudentTaskID);
        console.log('tasks:', tasks);
        const ul = document.getElementById("task-list");

        tasks.forEach(task => {
            const li = document.createElement("li");
            //li.innerHTML = `Задача: <a href="/students_subtasks/T/${task.StudentTaskID}">${task.SubTaskID}</a> - ${task.CompletionStatus}`;
            li.innerHTML = `Задача: <a href="http://${location.host}/students_subtasks/T/${task.StudentTaskID}">${task.SubTaskID}</a> - ${task.CompletionStatus} <b>${task.Description}</b> ${task.TaskTitle} `;
            ul.appendChild(li);
        });
    </script>
{% endblock %}

