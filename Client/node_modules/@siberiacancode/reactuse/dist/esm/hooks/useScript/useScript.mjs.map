{"version":3,"file":"useScript.mjs","sources":["../../../../src/hooks/useScript/useScript.ts"],"sourcesContent":["import type { ComponentProps } from 'react';\n\nimport { useEffect, useState } from 'react';\n\n/** The use script status */\nexport type UseScriptStatus = 'error' | 'loading' | 'ready' | 'unknown';\nexport const SCRIPT_STATUS_ATTRIBUTE_NAME = 'script-status';\n\n/** The use script options extends from attributes script tag */\nexport interface UseScriptOptions extends ComponentProps<'script'> {\n  /** Whether to remove the script on unmount */\n  removeOnUnmount?: boolean;\n}\n\n/**\n * @name useScript\n * @description - Hook that manages a script with onLoad, onError, and removeOnUnmount functionalities\n * @category Elements\n *\n * @param {string} src The source of the script\n * @param {UseScriptOptions} [options] The options of the script extends from attributes script tag\n * @param {boolean} [options.removeOnUnmount=true] Whether to remove the script on unmount\n * @param {boolean} [options.async=true] Whether to load the script asynchronously\n * @returns {UseScriptStatus} The status of the script\n *\n * @example\n * const status = useScript('https://example.com/script.js');\n */\nexport const useScript = (src: string, options: UseScriptOptions = {}) => {\n  const [status, setStatus] = useState<UseScriptStatus>(() => {\n    const script = document.querySelector(`script[src=\"${src}\"]`) as HTMLScriptElement;\n    const scriptStatus = script?.getAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME) as UseScriptStatus;\n    if (scriptStatus) return scriptStatus;\n    if (script) return 'unknown';\n\n    return 'loading';\n  });\n  const { removeOnUnmount = true, async = true } = options;\n\n  useEffect(() => {\n    const existedScript = document.querySelector(`script[src=\"${src}\"]`) as HTMLScriptElement;\n    const scriptStatus = existedScript?.getAttribute(\n      SCRIPT_STATUS_ATTRIBUTE_NAME\n    ) as UseScriptStatus;\n    if (scriptStatus) return setStatus(scriptStatus);\n    if (existedScript) return setStatus('unknown');\n\n    const script = document.createElement('script');\n    script.src = src;\n    script.async = async;\n\n    for (const [key, value] of Object.entries(options)) {\n      script.setAttribute(key, String(value));\n    }\n\n    script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'loading');\n    document.body.appendChild(script);\n\n    const onLoad = () => {\n      script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'ready');\n      setStatus('ready');\n    };\n\n    const onError = () => {\n      script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'error');\n      setStatus('error');\n    };\n\n    script.addEventListener('load', onLoad);\n    script.addEventListener('error', onError);\n\n    return () => {\n      if (removeOnUnmount) script.remove();\n      script.removeEventListener('load', onLoad);\n      script.removeEventListener('error', onError);\n    };\n  }, [src, removeOnUnmount]);\n\n  return status;\n};\n"],"names":["SCRIPT_STATUS_ATTRIBUTE_NAME","useScript","src","options","status","setStatus","useState","script","scriptStatus","removeOnUnmount","async","useEffect","existedScript","key","value","onLoad","onError"],"mappings":";AAMO,MAAMA,IAA+B,iBAsB/BC,IAAY,CAACC,GAAaC,IAA4B,OAAO;AACxE,QAAM,CAACC,GAAQC,CAAS,IAAIC,EAA0B,MAAM;AAC1D,UAAMC,IAAS,SAAS,cAAc,eAAeL,CAAG,IAAI,GACtDM,IAAeD,GAAQ,aAAaP,CAA4B;AACtE,WAAIQ,MACAD,IAAe,YAEZ;AAAA,EAAA,CACR,GACK,EAAE,iBAAAE,IAAkB,IAAM,OAAAC,IAAQ,OAASP;AAEjD,SAAAQ,EAAU,MAAM;AACd,UAAMC,IAAgB,SAAS,cAAc,eAAeV,CAAG,IAAI,GAC7DM,IAAeI,GAAe;AAAA,MAClCZ;AAAA,IAAA;AAEF,QAAIQ,EAAc,QAAOH,EAAUG,CAAY;AAC/C,QAAII,EAAe,QAAOP,EAAU,SAAS;AAE7C,UAAME,IAAS,SAAS,cAAc,QAAQ;AAC9C,IAAAA,EAAO,MAAML,GACbK,EAAO,QAAQG;AAEf,eAAW,CAACG,GAAKC,CAAK,KAAK,OAAO,QAAQX,CAAO;AAC/C,MAAAI,EAAO,aAAaM,GAAK,OAAOC,CAAK,CAAC;AAGxC,IAAAP,EAAO,aAAaP,GAA8B,SAAS,GAC3D,SAAS,KAAK,YAAYO,CAAM;AAEhC,UAAMQ,IAAS,MAAM;AACnB,MAAAR,EAAO,aAAaP,GAA8B,OAAO,GACzDK,EAAU,OAAO;AAAA,IAAA,GAGbW,IAAU,MAAM;AACpB,MAAAT,EAAO,aAAaP,GAA8B,OAAO,GACzDK,EAAU,OAAO;AAAA,IAAA;AAGnB,WAAAE,EAAO,iBAAiB,QAAQQ,CAAM,GACtCR,EAAO,iBAAiB,SAASS,CAAO,GAEjC,MAAM;AACX,MAAIP,OAAwB,OAAA,GAC5BF,EAAO,oBAAoB,QAAQQ,CAAM,GACzCR,EAAO,oBAAoB,SAASS,CAAO;AAAA,IAAA;AAAA,EAC7C,GACC,CAACd,GAAKO,CAAe,CAAC,GAElBL;AACT;"}