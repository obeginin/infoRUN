{"version":3,"file":"useBroadcastChannel.mjs","sources":["../../../../src/hooks/useBroadcastChannel/useBroadcastChannel.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\n\n/** The use broadcast channel return type */\nexport interface UseBroadcastChannelReturn<Data = unknown> {\n  /** The underlying BroadcastChannel instance if supported, undefined otherwise */\n  channel?: BroadcastChannel;\n  /** Whether the channel has been closed */\n  closed: boolean;\n  /** The most recently received data from other contexts */\n  data?: Data;\n  /** Error object if any error occurred during channel operations */\n  error?: Event;\n  /** Whether the BroadcastChannel API is supported in the current environment */\n  supported: boolean;\n  /** Function to close the channel and clean up resources */\n  close: () => void;\n  /** Function to send data to other contexts through the channel */\n  post: (data: Data) => void;\n}\n\n/**\n * @name useBroadcastChannel\n * @description Hook that provides cross-tab/window communication\n * @category Browser\n *\n * @browserapi BroadcastChannel https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel\n *\n * @param {string} name The name of the channel\n * @param {Function} callback A callback function that will be called when a message is received\n * @returns {UseBroadcastChannelReturn} An object containing the channel state and controls\n *\n * @example\n * const { supported, data, post, error } = useBroadcastChannel('channel');\n */\nexport const useBroadcastChannel = <Data = unknown>(\n  name: string,\n  callback?: (data: Data) => void\n): UseBroadcastChannelReturn<Data> => {\n  const supported = typeof window !== 'undefined' && 'BroadcastChannel' in window;\n\n  const [closed, setClosed] = useState(false);\n  const [data, setData] = useState<Data>();\n  const [error, setError] = useState<MessageEvent>();\n  const channelRef = useRef<BroadcastChannel>(undefined);\n\n  useEffect(() => {\n    if (!supported) return;\n\n    channelRef.current = new BroadcastChannel(name);\n\n    const onMessage = (event: MessageEvent) => {\n      setData(event.data);\n      callback?.(event.data);\n    };\n    const onMessageError = (event: MessageEvent) => setError(event);\n    const onClose = () => setClosed(true);\n\n    channelRef.current.addEventListener('message', onMessage);\n    channelRef.current.addEventListener('messageerror', onMessageError);\n    channelRef.current.addEventListener('close', onClose);\n\n    return () => {\n      if (channelRef.current) {\n        channelRef.current.removeEventListener('message', onMessage);\n        channelRef.current.removeEventListener('messageerror', onMessageError);\n        channelRef.current.removeEventListener('close', onClose);\n        channelRef.current.close();\n      }\n    };\n  }, [name]);\n\n  const post = (data: Data) => {\n    console.log('post', data, channelRef.current);\n    if (!channelRef.current) return;\n    channelRef.current.postMessage(data);\n  };\n\n  const close = () => {\n    if (!channelRef.current) return;\n    channelRef.current.close();\n    setClosed(true);\n  };\n\n  return {\n    supported,\n    channel: channelRef.current,\n    data,\n    post,\n    close,\n    error,\n    closed\n  };\n};\n"],"names":["useBroadcastChannel","name","callback","supported","closed","setClosed","useState","data","setData","error","setError","channelRef","useRef","useEffect","onMessage","event","onMessageError","onClose","post","close"],"mappings":";AAkCO,MAAMA,IAAsB,CACjCC,GACAC,MACoC;AACpC,QAAMC,IAAY,OAAO,SAAW,OAAe,sBAAsB,QAEnE,CAACC,GAAQC,CAAS,IAAIC,EAAS,EAAK,GACpC,CAACC,GAAMC,CAAO,IAAIF,EAAA,GAClB,CAACG,GAAOC,CAAQ,IAAIJ,EAAA,GACpBK,IAAaC,EAAyB,MAAS;AAErD,EAAAC,EAAU,MAAM;AACd,QAAI,CAACV,EAAW;AAEhB,IAAAQ,EAAW,UAAU,IAAI,iBAAiBV,CAAI;AAE9C,UAAMa,IAAY,CAACC,MAAwB;AACzC,MAAAP,EAAQO,EAAM,IAAI,GAClBb,IAAWa,EAAM,IAAI;AAAA,IAAA,GAEjBC,IAAiB,CAACD,MAAwBL,EAASK,CAAK,GACxDE,IAAU,MAAMZ,EAAU,EAAI;AAEpC,WAAAM,EAAW,QAAQ,iBAAiB,WAAWG,CAAS,GACxDH,EAAW,QAAQ,iBAAiB,gBAAgBK,CAAc,GAClEL,EAAW,QAAQ,iBAAiB,SAASM,CAAO,GAE7C,MAAM;AACX,MAAIN,EAAW,YACbA,EAAW,QAAQ,oBAAoB,WAAWG,CAAS,GAC3DH,EAAW,QAAQ,oBAAoB,gBAAgBK,CAAc,GACrEL,EAAW,QAAQ,oBAAoB,SAASM,CAAO,GACvDN,EAAW,QAAQ,MAAA;AAAA,IACrB;AAAA,EACF,GACC,CAACV,CAAI,CAAC;AAET,QAAMiB,IAAO,CAACX,MAAe;AAE3B,IADA,QAAQ,IAAI,QAAQA,GAAMI,EAAW,OAAO,GACvCA,EAAW,WAChBA,EAAW,QAAQ,YAAYJ,CAAI;AAAA,EAAA,GAG/BY,IAAQ,MAAM;AAClB,IAAKR,EAAW,YAChBA,EAAW,QAAQ,MAAA,GACnBN,EAAU,EAAI;AAAA,EAAA;AAGhB,SAAO;AAAA,IACL,WAAAF;AAAA,IACA,SAASQ,EAAW;AAAA,IACpB,MAAAJ;AAAA,IACA,MAAAW;AAAA,IACA,OAAAC;AAAA,IACA,OAAAV;AAAA,IACA,QAAAL;AAAA,EAAA;AAEJ;"}