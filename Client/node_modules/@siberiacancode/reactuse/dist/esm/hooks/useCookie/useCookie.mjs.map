{"version":3,"file":"useCookie.mjs","sources":["../../../../src/hooks/useCookie/useCookie.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nexport const getCookies = () =>\n  Object.fromEntries(\n    document.cookie.split('; ').map((cookie) => {\n      const [key, ...value] = cookie.split('=');\n      const decodedValue = decodeURIComponent(value.join('='));\n      return [key, decodedValue];\n    })\n  );\n\nexport interface RemoveCookieParams {\n  domain?: string;\n  expires?: Date;\n  maxAge?: number;\n  path?: string;\n  sameSite?: 'Lax' | 'None' | 'Strict';\n  secure?: boolean;\n}\n\nexport const removeCookie = (key: string, options: RemoveCookieParams = {}) => {\n  document.cookie = `${encodeURIComponent(key)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT${\n    options.path ? `; path=${options.path}` : ''\n  }${options.domain ? `; domain=${options.domain}` : ''}${\n    options.maxAge ? `; max-age=0` : ''\n  }${options.expires ? `; expires=Thu, 01 Jan 1970 00:00:00 GMT` : ''}${\n    options.secure ? `; secure` : ''\n  }${options.sameSite ? `; samesite=${options.sameSite}` : ''}`;\n};\n\nexport interface SetCookieParams {\n  domain?: string;\n  expires?: Date;\n  httpOnly?: boolean;\n  maxAge?: number;\n  path?: string;\n  sameSite?: 'Lax' | 'None' | 'Strict';\n  secure?: boolean;\n}\n\nexport const setCookie = (key: string, value: string, options: SetCookieParams = {}) => {\n  const cookie = [`${encodeURIComponent(key)}=${encodeURIComponent(value)}`];\n\n  if (options.path) cookie.push(`path=${options.path}`);\n  if (options.domain) cookie.push(`domain=${options.domain}`);\n  if (typeof options.maxAge === 'number') cookie.push(`max-age=${options.maxAge}`);\n  if (options.expires) cookie.push(`expires=${options.expires.toUTCString()}`);\n  if (options.secure) cookie.push(`secure`);\n  if (options.httpOnly) cookie.push(`httpOnly`);\n  if (options.sameSite) cookie.push(`samesite=${options.sameSite}`);\n\n  document.cookie = cookie.join('; ');\n};\n\n/* The use cookie initial value type */\nexport type UseCookieInitialValue<Value> = (() => Value) | Value;\n\n/* The use cookie options type */\nexport interface UseCookieOptions<Value> {\n  /* The domain of the cookie */\n  domain?: string;\n  /* The expiration date of the cookie */\n  expires?: Date;\n  /* Whether the cookie is httpOnly */\n  httpOnly?: boolean;\n  /* The initial value of the storage */\n  initialValue?: UseCookieInitialValue<Value>;\n  /* The maximum age of the cookie */\n  maxAge?: number;\n  /* The path of the cookie */\n  path?: string;\n  /* The sameSite of the cookie */\n  sameSite?: 'Lax' | 'None' | 'Strict';\n  /* Whether the cookie is secure */\n  secure?: boolean;\n  /* The deserializer function to be invoked */\n  deserializer?: (value: string) => Value;\n  /* The serializer function to be invoked */\n  serializer?: (value: Value) => string;\n}\n\n/* The use cookie return type */\nexport interface UseCookieReturn<Value> {\n  /* The value of the cookie */\n  value: Value;\n  /* The remove function */\n  remove: (options?: RemoveCookieParams) => void;\n  /* The set function */\n  set: (value: Value, options?: SetCookieParams) => void;\n}\n\nexport const COOKIE_EVENT = 'reactuse-cookie';\n\nexport const dispatchCookieEvent = () => window.dispatchEvent(new Event(COOKIE_EVENT));\n\nexport const setCookieItem = (key: string, value: string, options?: SetCookieParams) => {\n  setCookie(key, value, options);\n  dispatchCookieEvent();\n};\n\nexport const removeCookieItem = (key: string, options?: RemoveCookieParams) => {\n  removeCookie(key, options);\n  dispatchCookieEvent();\n};\n\nexport const getCookie = (key: string): string | undefined => {\n  const cookies = getCookies();\n  return cookies[key];\n};\n\nexport interface UseCookie {\n  <Value>(\n    key: string,\n    options: UseCookieOptions<Value> & {\n      initialValue: UseCookieInitialValue<Value>;\n    }\n  ): UseCookieReturn<Value>;\n\n  <Value>(key: string, options?: UseCookieOptions<Value>): UseCookieReturn<Value | undefined>;\n\n  <Value>(key: string, initialValue: UseCookieInitialValue<Value>): UseCookieReturn<Value>;\n\n  <Value>(key: string): UseCookieReturn<Value | undefined>;\n}\n\n/**\n * @name useCookie\n * @description - Hook that manages cookie value\n * @category State\n *\n * @overload\n * @template Value The type of the cookie value\n * @param {string} key The key of the cookie\n * @param {UseCookieInitialValue<Value>} [initialValue] The initial value of the cookie\n * @returns {UseCookieReturn<Value>} The value and the set function\n *\n * @overload\n * @template Value The type of the cookie value\n * @param {string} key The key of the cookie\n * @param {UseCookieOptions<Value>} options The options object\n * @param {UseCookieInitialValue<Value>} [options.initialValue] The initial value of the cookie\n * @param {(value: string) => Value} [options.deserializer] The deserializer function to be invoked\n * @param {(value: Value) => string} [options.serializer] The serializer function to be invoked\n * @returns {UseCookieReturn<Value | undefined>} The value and the set function\n *\n * @example\n * const { value, set, remove } = useCookie('key', 'value');\n */\nexport const useCookie = (<Value>(key: string, params?: any) => {\n  const options = (\n    typeof params === 'object' &&\n    params &&\n    ('serializer' in params || 'deserializer' in params || 'initialValue' in params)\n      ? params\n      : undefined\n  ) as UseCookieOptions<Value>;\n  const initialValue = (options ? options?.initialValue : params) as UseCookieInitialValue<Value>;\n\n  if (typeof document === 'undefined')\n    return {\n      value: typeof initialValue === 'function' ? (initialValue as () => Value)() : initialValue\n    } as UseCookieReturn<Value>;\n\n  const serializer = (value: Value) => {\n    if (options?.serializer) return options.serializer(value);\n    if (typeof value === 'string') return value;\n    return JSON.stringify(value);\n  };\n\n  const deserializer = (value: string) => {\n    if (options?.deserializer) return options.deserializer(value);\n    if (value === 'undefined') return undefined as unknown as Value;\n\n    try {\n      return JSON.parse(value) as Value;\n    } catch {\n      return value as Value;\n    }\n  };\n\n  const [value, setValue] = useState<Value | undefined>(() => {\n    const cookieValue = getCookie(key);\n    if (cookieValue === undefined && initialValue !== undefined) {\n      const value =\n        typeof initialValue === 'function' ? (initialValue as () => Value)() : initialValue;\n      setCookieItem(key, serializer(value), options);\n      return value;\n    }\n    return cookieValue ? deserializer(cookieValue) : undefined;\n  });\n\n  useEffect(() => {\n    const onChange = () => {\n      const cookieValue = getCookie(key);\n      setValue(cookieValue ? deserializer(cookieValue) : undefined);\n    };\n    window.addEventListener(COOKIE_EVENT, onChange);\n    return () => window.removeEventListener(COOKIE_EVENT, onChange);\n  }, [key]);\n\n  const set = (value: Value, params?: SetCookieParams) =>\n    setCookieItem(key, serializer(value), { ...options, ...params });\n  const remove = (params?: RemoveCookieParams) => removeCookieItem(key, { ...options, ...params });\n\n  return { value, set, remove };\n}) as UseCookie;\n"],"names":["getCookies","cookie","key","value","decodedValue","removeCookie","options","setCookie","COOKIE_EVENT","dispatchCookieEvent","setCookieItem","removeCookieItem","getCookie","useCookie","params","initialValue","serializer","deserializer","setValue","useState","cookieValue","useEffect","onChange"],"mappings":"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"}