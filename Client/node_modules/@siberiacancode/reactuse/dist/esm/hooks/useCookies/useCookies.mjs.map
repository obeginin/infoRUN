{"version":3,"file":"useCookies.mjs","sources":["../../../../src/hooks/useCookies/useCookies.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport type { RemoveCookieParams, SetCookieParams } from '../useCookie/useCookie';\n\nimport {\n  COOKIE_EVENT,\n  dispatchCookieEvent,\n  removeCookie,\n  removeCookieItem,\n  setCookieItem\n} from '../useCookie/useCookie';\n\n/** The cookies params type */\nexport type CookieParams = Record<string, any>;\n\n/* The use cookies options type */\nexport interface UseCookiesOptions<Value> {\n  /* The deserializer function to be invoked */\n  deserializer?: (value: string) => Value[keyof Value];\n  /* The serializer function to be invoked */\n  serializer?: (value: Value[keyof Value]) => string;\n}\n\nexport const clearCookies = () => {\n  document.cookie.split('; ').forEach((cookie) => {\n    const [name] = cookie.split('=');\n    removeCookie(name);\n  });\n};\n\nconst clearCookieItems = () => {\n  clearCookies();\n  dispatchCookieEvent();\n};\n\n/**\n * @name useCookies\n * @description - Hook that manages cookie values\n * @category State\n *\n * @overload\n * @template {object} Value The type of the cookie values\n * @returns {UseCookieReturn<Value>} The value and the set function\n *\n * @example\n * const { value, set, remove, getAll, clear } = useCookies();\n */\nexport const useCookies = <Value extends CookieParams>(options?: UseCookiesOptions<Value>) => {\n  const serializer = (value: Value[keyof Value]) => {\n    if (options?.serializer) return options.serializer(value);\n    if (typeof value === 'string') return value;\n    return JSON.stringify(value);\n  };\n\n  const deserializer = (value: string) => {\n    if (options?.deserializer) return options.deserializer(value);\n    if (value === 'undefined') return undefined as unknown as Value[keyof Value];\n\n    try {\n      return JSON.parse(value) as Value;\n    } catch {\n      return value as Value[keyof Value];\n    }\n  };\n\n  const getParsedCookies = () => {\n    if (!document.cookie) return {};\n\n    return Object.fromEntries(\n      document.cookie\n        .split('; ')\n        .map((cookie) => {\n          const [key, ...value] = cookie.split('=');\n          if (!key || !value.length) return [];\n          const decodedValue = decodeURIComponent(value.join('='));\n          return [key, deserializer(decodedValue)];\n        })\n        .filter((entry) => entry.length)\n    );\n  };\n\n  const [value, setValue] = useState(() => {\n    if (typeof window === 'undefined') return {} as Value;\n    return getParsedCookies() as Value;\n  });\n\n  useEffect(() => {\n    const onChange = () => setValue(getParsedCookies() as Value);\n\n    window.addEventListener(COOKIE_EVENT, onChange);\n    return () => {\n      window.removeEventListener(COOKIE_EVENT, onChange);\n    };\n  }, []);\n\n  const set = <Key extends keyof Value>(key: Key, value: Value[Key], options?: SetCookieParams) =>\n    setCookieItem(key as string, serializer(value), options);\n\n  const remove = <Key extends keyof Value>(key: Key, options?: RemoveCookieParams) =>\n    removeCookieItem(key as string, options);\n  const getAll = () => getParsedCookies();\n  const clear = () => clearCookieItems();\n\n  return { value, set, remove, getAll, clear };\n};\n"],"names":["clearCookies","cookie","name","removeCookie","clearCookieItems","dispatchCookieEvent","useCookies","options","serializer","value","deserializer","getParsedCookies","key","decodedValue","entry","setValue","useState","useEffect","onChange","COOKIE_EVENT","setCookieItem","removeCookieItem"],"mappings":";;AAuBO,MAAMA,IAAe,MAAM;AAChC,WAAS,OAAO,MAAM,IAAI,EAAE,QAAQ,CAACC,MAAW;AAC9C,UAAM,CAACC,CAAI,IAAID,EAAO,MAAM,GAAG;AAC/B,IAAAE,EAAaD,CAAI;AAAA,EAAA,CAClB;AACH,GAEME,IAAmB,MAAM;AAC7B,EAAAJ,EAAA,GACAK,EAAA;AACF,GAcaC,IAAa,CAA6BC,MAAuC;AAC5F,QAAMC,IAAa,CAACC,MACdF,GAAS,aAAmBA,EAAQ,WAAWE,CAAK,IACpD,OAAOA,KAAU,WAAiBA,IAC/B,KAAK,UAAUA,CAAK,GAGvBC,IAAe,CAACD,MAAkB;AACtC,QAAIF,GAAS,aAAc,QAAOA,EAAQ,aAAaE,CAAK;AAC5D,QAAIA,MAAU;AAEd,UAAI;AACF,eAAO,KAAK,MAAMA,CAAK;AAAA,MAAA,QACjB;AACN,eAAOA;AAAAA,MAAA;AAAA,EACT,GAGIE,IAAmB,MAClB,SAAS,SAEP,OAAO;AAAA,IACZ,SAAS,OACN,MAAM,IAAI,EACV,IAAI,CAACV,MAAW;AACf,YAAM,CAACW,GAAK,GAAGH,CAAK,IAAIR,EAAO,MAAM,GAAG;AACxC,UAAI,CAACW,KAAO,CAACH,EAAM,eAAe,CAAA;AAClC,YAAMI,IAAe,mBAAmBJ,EAAM,KAAK,GAAG,CAAC;AACvD,aAAO,CAACG,GAAKF,EAAaG,CAAY,CAAC;AAAA,IAAA,CACxC,EACA,OAAO,CAACC,MAAUA,EAAM,MAAM;AAAA,EAAA,IAXN,CAAA,GAezB,CAACL,GAAOM,CAAQ,IAAIC,EAAS,MAC7B,OAAO,SAAW,MAAoB,CAAA,IACnCL,EAAA,CACR;AAED,SAAAM,EAAU,MAAM;AACd,UAAMC,IAAW,MAAMH,EAASJ,GAA2B;AAE3D,kBAAO,iBAAiBQ,GAAcD,CAAQ,GACvC,MAAM;AACX,aAAO,oBAAoBC,GAAcD,CAAQ;AAAA,IAAA;AAAA,EACnD,GACC,EAAE,GAUE,EAAE,OAAAT,GAAO,KARJ,CAA0BG,GAAUH,GAAmBF,MACjEa,EAAcR,GAAeJ,EAAWC,CAAK,GAAGF,CAAO,GAOpC,QALN,CAA0BK,GAAUL,MACjDc,EAAiBT,GAAeL,CAAO,GAIZ,QAHd,MAAMI,EAAA,GAGgB,OAFvB,MAAMP,EAAA,EAEiB;AACvC;"}