{"version":3,"file":"usePermission.mjs","sources":["../../../../src/hooks/usePermission/usePermission.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport { useEvent } from '../useEvent/useEvent';\n\n/** The permission name */\nexport type UsePermissionName =\n  | 'accelerometer'\n  | 'accessibility-events'\n  | 'ambient-light-sensor'\n  | 'background-sync'\n  | 'camera'\n  | 'clipboard-read'\n  | 'clipboard-write'\n  | 'gyroscope'\n  | 'magnetometer'\n  | 'microphone'\n  | 'notifications'\n  | 'payment-handler'\n  | 'persistent-storage'\n  | 'push'\n  | 'speaker'\n  | PermissionName;\n\n/** The use permission options type */\nexport interface UsePermissionOptions {\n  /** Whether the permission is enabled */\n  enabled: boolean;\n}\n\n/** The use permission return type */\nexport interface UsePermissionReturn {\n  /** The permission state */\n  state: PermissionState;\n  /** The permission supported status */\n  supported: boolean;\n  /** The permission query function */\n  query: () => Promise<PermissionState>;\n}\n\n/**\n *  @name usePermission\n *  @description - Hook that gives you the state of permission\n *  @category Browser\n *\n *  @browserapi navigator.permissions https://developer.mozilla.org/en-US/docs/Web/API/Navigator/permissions\n *\n *  @param {UsePermissionName} permissionDescriptorName - The permission name\n *  @param {boolean} [options.enabled=true] - Whether the permission is enabled\n *  @returns {UsePermissionReturn} An object containing the state and the supported status\n *\n *  @example\n *  const { state, supported, query } = usePermission('microphone');\n */\nexport const usePermission = (\n  permissionDescriptorName: UsePermissionName,\n  options?: UsePermissionOptions\n) => {\n  const supported = typeof navigator !== 'undefined' && 'permissions' in navigator;\n  const [state, setState] = useState<PermissionState>('prompt');\n  const enabled = options?.enabled ?? true;\n\n  const permissionDescriptor = { name: permissionDescriptorName };\n\n  const query = useEvent(async () => {\n    try {\n      const permissionStatus = await navigator.permissions.query(\n        permissionDescriptor as PermissionDescriptor\n      );\n      setState(permissionStatus.state);\n      return permissionStatus.state;\n    } catch {\n      setState('prompt');\n      return 'prompt';\n    }\n  });\n\n  useEffect(() => {\n    if (!supported || !enabled) return;\n    query();\n    window.addEventListener('change', query);\n    return () => {\n      window.removeEventListener('change', query);\n    };\n  }, [permissionDescriptorName, enabled]);\n\n  return {\n    state,\n    supported,\n    query\n  };\n};\n"],"names":["usePermission","permissionDescriptorName","options","supported","state","setState","useState","enabled","permissionDescriptor","query","useEvent","permissionStatus","useEffect"],"mappings":";;AAqDO,MAAMA,IAAgB,CAC3BC,GACAC,MACG;AACH,QAAMC,IAAY,OAAO,YAAc,OAAe,iBAAiB,WACjE,CAACC,GAAOC,CAAQ,IAAIC,EAA0B,QAAQ,GACtDC,IAAUL,GAAS,WAAW,IAE9BM,IAAuB,EAAE,MAAMP,EAAA,GAE/BQ,IAAQC,EAAS,YAAY;AACjC,QAAI;AACF,YAAMC,IAAmB,MAAM,UAAU,YAAY;AAAA,QACnDH;AAAA,MAAA;AAEF,aAAAH,EAASM,EAAiB,KAAK,GACxBA,EAAiB;AAAA,IAAA,QAClB;AACN,aAAAN,EAAS,QAAQ,GACV;AAAA,IAAA;AAAA,EACT,CACD;AAED,SAAAO,EAAU,MAAM;AACd,QAAI,GAACT,KAAa,CAACI;AACnB,aAAAE,EAAA,GACA,OAAO,iBAAiB,UAAUA,CAAK,GAChC,MAAM;AACX,eAAO,oBAAoB,UAAUA,CAAK;AAAA,MAAA;AAAA,EAC5C,GACC,CAACR,GAA0BM,CAAO,CAAC,GAE/B;AAAA,IACL,OAAAH;AAAA,IACA,WAAAD;AAAA,IACA,OAAAM;AAAA,EAAA;AAEJ;"}