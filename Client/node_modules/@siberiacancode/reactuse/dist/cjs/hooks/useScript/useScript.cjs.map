{"version":3,"file":"useScript.cjs","sources":["../../../../src/hooks/useScript/useScript.ts"],"sourcesContent":["import type { ComponentProps } from 'react';\n\nimport { useEffect, useState } from 'react';\n\n/** The use script status */\nexport type UseScriptStatus = 'error' | 'loading' | 'ready' | 'unknown';\nexport const SCRIPT_STATUS_ATTRIBUTE_NAME = 'script-status';\n\n/** The use script options extends from attributes script tag */\nexport interface UseScriptOptions extends ComponentProps<'script'> {\n  /** Whether to remove the script on unmount */\n  removeOnUnmount?: boolean;\n}\n\n/**\n * @name useScript\n * @description - Hook that manages a script with onLoad, onError, and removeOnUnmount functionalities\n * @category Elements\n *\n * @param {string} src The source of the script\n * @param {UseScriptOptions} [options] The options of the script extends from attributes script tag\n * @param {boolean} [options.removeOnUnmount=true] Whether to remove the script on unmount\n * @param {boolean} [options.async=true] Whether to load the script asynchronously\n * @returns {UseScriptStatus} The status of the script\n *\n * @example\n * const status = useScript('https://example.com/script.js');\n */\nexport const useScript = (src: string, options: UseScriptOptions = {}) => {\n  const [status, setStatus] = useState<UseScriptStatus>(() => {\n    const script = document.querySelector(`script[src=\"${src}\"]`) as HTMLScriptElement;\n    const scriptStatus = script?.getAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME) as UseScriptStatus;\n    if (scriptStatus) return scriptStatus;\n    if (script) return 'unknown';\n\n    return 'loading';\n  });\n  const { removeOnUnmount = true, async = true } = options;\n\n  useEffect(() => {\n    const existedScript = document.querySelector(`script[src=\"${src}\"]`) as HTMLScriptElement;\n    const scriptStatus = existedScript?.getAttribute(\n      SCRIPT_STATUS_ATTRIBUTE_NAME\n    ) as UseScriptStatus;\n    if (scriptStatus) return setStatus(scriptStatus);\n    if (existedScript) return setStatus('unknown');\n\n    const script = document.createElement('script');\n    script.src = src;\n    script.async = async;\n\n    for (const [key, value] of Object.entries(options)) {\n      script.setAttribute(key, String(value));\n    }\n\n    script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'loading');\n    document.body.appendChild(script);\n\n    const onLoad = () => {\n      script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'ready');\n      setStatus('ready');\n    };\n\n    const onError = () => {\n      script.setAttribute(SCRIPT_STATUS_ATTRIBUTE_NAME, 'error');\n      setStatus('error');\n    };\n\n    script.addEventListener('load', onLoad);\n    script.addEventListener('error', onError);\n\n    return () => {\n      if (removeOnUnmount) script.remove();\n      script.removeEventListener('load', onLoad);\n      script.removeEventListener('error', onError);\n    };\n  }, [src, removeOnUnmount]);\n\n  return status;\n};\n"],"names":["SCRIPT_STATUS_ATTRIBUTE_NAME","useScript","src","options","status","setStatus","useState","script","scriptStatus","removeOnUnmount","async","useEffect","existedScript","key","value","onLoad","onError"],"mappings":"yGAMaA,EAA+B,gBAsB/BC,EAAY,CAACC,EAAaC,EAA4B,KAAO,CACxE,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAA0B,IAAM,CAC1D,MAAMC,EAAS,SAAS,cAAc,eAAeL,CAAG,IAAI,EACtDM,EAAeD,GAAQ,aAAaP,CAA4B,EACtE,OAAIQ,IACAD,EAAe,UAEZ,UAAA,CACR,EACK,CAAE,gBAAAE,EAAkB,GAAM,MAAAC,EAAQ,IAASP,EAEjDQ,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAgB,SAAS,cAAc,eAAeV,CAAG,IAAI,EAC7DM,EAAeI,GAAe,aAClCZ,CAAA,EAEF,GAAIQ,EAAc,OAAOH,EAAUG,CAAY,EAC/C,GAAII,EAAe,OAAOP,EAAU,SAAS,EAE7C,MAAME,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,IAAML,EACbK,EAAO,MAAQG,EAEf,SAAW,CAACG,EAAKC,CAAK,IAAK,OAAO,QAAQX,CAAO,EAC/CI,EAAO,aAAaM,EAAK,OAAOC,CAAK,CAAC,EAGxCP,EAAO,aAAaP,EAA8B,SAAS,EAC3D,SAAS,KAAK,YAAYO,CAAM,EAEhC,MAAMQ,EAAS,IAAM,CACnBR,EAAO,aAAaP,EAA8B,OAAO,EACzDK,EAAU,OAAO,CAAA,EAGbW,EAAU,IAAM,CACpBT,EAAO,aAAaP,EAA8B,OAAO,EACzDK,EAAU,OAAO,CAAA,EAGnB,OAAAE,EAAO,iBAAiB,OAAQQ,CAAM,EACtCR,EAAO,iBAAiB,QAASS,CAAO,EAEjC,IAAM,CACPP,KAAwB,OAAA,EAC5BF,EAAO,oBAAoB,OAAQQ,CAAM,EACzCR,EAAO,oBAAoB,QAASS,CAAO,CAAA,CAC7C,EACC,CAACd,EAAKO,CAAe,CAAC,EAElBL,CACT"}