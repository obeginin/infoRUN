{"version":3,"file":"useCookies.cjs","sources":["../../../../src/hooks/useCookies/useCookies.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport type { RemoveCookieParams, SetCookieParams } from '../useCookie/useCookie';\n\nimport {\n  COOKIE_EVENT,\n  dispatchCookieEvent,\n  removeCookie,\n  removeCookieItem,\n  setCookieItem\n} from '../useCookie/useCookie';\n\n/** The cookies params type */\nexport type CookieParams = Record<string, any>;\n\n/* The use cookies options type */\nexport interface UseCookiesOptions<Value> {\n  /* The deserializer function to be invoked */\n  deserializer?: (value: string) => Value[keyof Value];\n  /* The serializer function to be invoked */\n  serializer?: (value: Value[keyof Value]) => string;\n}\n\nexport const clearCookies = () => {\n  document.cookie.split('; ').forEach((cookie) => {\n    const [name] = cookie.split('=');\n    removeCookie(name);\n  });\n};\n\nconst clearCookieItems = () => {\n  clearCookies();\n  dispatchCookieEvent();\n};\n\n/**\n * @name useCookies\n * @description - Hook that manages cookie values\n * @category State\n *\n * @overload\n * @template {object} Value The type of the cookie values\n * @returns {UseCookieReturn<Value>} The value and the set function\n *\n * @example\n * const { value, set, remove, getAll, clear } = useCookies();\n */\nexport const useCookies = <Value extends CookieParams>(options?: UseCookiesOptions<Value>) => {\n  const serializer = (value: Value[keyof Value]) => {\n    if (options?.serializer) return options.serializer(value);\n    if (typeof value === 'string') return value;\n    return JSON.stringify(value);\n  };\n\n  const deserializer = (value: string) => {\n    if (options?.deserializer) return options.deserializer(value);\n    if (value === 'undefined') return undefined as unknown as Value[keyof Value];\n\n    try {\n      return JSON.parse(value) as Value;\n    } catch {\n      return value as Value[keyof Value];\n    }\n  };\n\n  const getParsedCookies = () => {\n    if (!document.cookie) return {};\n\n    return Object.fromEntries(\n      document.cookie\n        .split('; ')\n        .map((cookie) => {\n          const [key, ...value] = cookie.split('=');\n          if (!key || !value.length) return [];\n          const decodedValue = decodeURIComponent(value.join('='));\n          return [key, deserializer(decodedValue)];\n        })\n        .filter((entry) => entry.length)\n    );\n  };\n\n  const [value, setValue] = useState(() => {\n    if (typeof window === 'undefined') return {} as Value;\n    return getParsedCookies() as Value;\n  });\n\n  useEffect(() => {\n    const onChange = () => setValue(getParsedCookies() as Value);\n\n    window.addEventListener(COOKIE_EVENT, onChange);\n    return () => {\n      window.removeEventListener(COOKIE_EVENT, onChange);\n    };\n  }, []);\n\n  const set = <Key extends keyof Value>(key: Key, value: Value[Key], options?: SetCookieParams) =>\n    setCookieItem(key as string, serializer(value), options);\n\n  const remove = <Key extends keyof Value>(key: Key, options?: RemoveCookieParams) =>\n    removeCookieItem(key as string, options);\n  const getAll = () => getParsedCookies();\n  const clear = () => clearCookieItems();\n\n  return { value, set, remove, getAll, clear };\n};\n"],"names":["clearCookies","cookie","name","removeCookie","clearCookieItems","dispatchCookieEvent","useCookies","options","serializer","value","deserializer","getParsedCookies","key","decodedValue","entry","setValue","useState","useEffect","onChange","COOKIE_EVENT","setCookieItem","removeCookieItem"],"mappings":"iJAuBaA,EAAe,IAAM,CAChC,SAAS,OAAO,MAAM,IAAI,EAAE,QAASC,GAAW,CAC9C,KAAM,CAACC,CAAI,EAAID,EAAO,MAAM,GAAG,EAC/BE,EAAAA,aAAaD,CAAI,CAAA,CAClB,CACH,EAEME,EAAmB,IAAM,CAC7BJ,EAAA,EACAK,sBAAA,CACF,EAcaC,EAA0CC,GAAuC,CAC5F,MAAMC,EAAcC,GACdF,GAAS,WAAmBA,EAAQ,WAAWE,CAAK,EACpD,OAAOA,GAAU,SAAiBA,EAC/B,KAAK,UAAUA,CAAK,EAGvBC,EAAgBD,GAAkB,CACtC,GAAIF,GAAS,aAAc,OAAOA,EAAQ,aAAaE,CAAK,EAC5D,GAAIA,IAAU,YAEd,GAAI,CACF,OAAO,KAAK,MAAMA,CAAK,CAAA,MACjB,CACN,OAAOA,CAAA,CACT,EAGIE,EAAmB,IAClB,SAAS,OAEP,OAAO,YACZ,SAAS,OACN,MAAM,IAAI,EACV,IAAKV,GAAW,CACf,KAAM,CAACW,EAAK,GAAGH,CAAK,EAAIR,EAAO,MAAM,GAAG,EACxC,GAAI,CAACW,GAAO,CAACH,EAAM,aAAe,CAAA,EAClC,MAAMI,EAAe,mBAAmBJ,EAAM,KAAK,GAAG,CAAC,EACvD,MAAO,CAACG,EAAKF,EAAaG,CAAY,CAAC,CAAA,CACxC,EACA,OAAQC,GAAUA,EAAM,MAAM,CAAA,EAXN,CAAA,EAezB,CAACL,EAAOM,CAAQ,EAAIC,EAAAA,SAAS,IAC7B,OAAO,OAAW,IAAoB,CAAA,EACnCL,EAAA,CACR,EAEDM,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAW,IAAMH,EAASJ,GAA2B,EAE3D,cAAO,iBAAiBQ,EAAAA,aAAcD,CAAQ,EACvC,IAAM,CACX,OAAO,oBAAoBC,EAAAA,aAAcD,CAAQ,CAAA,CACnD,EACC,EAAE,EAUE,CAAE,MAAAT,EAAO,IARJ,CAA0BG,EAAUH,EAAmBF,IACjEa,gBAAcR,EAAeJ,EAAWC,CAAK,EAAGF,CAAO,EAOpC,OALN,CAA0BK,EAAUL,IACjDc,EAAAA,iBAAiBT,EAAeL,CAAO,EAIZ,OAHd,IAAMI,EAAA,EAGgB,MAFvB,IAAMP,EAAA,CAEiB,CACvC"}