{"version":3,"file":"useBroadcastChannel.cjs","sources":["../../../../src/hooks/useBroadcastChannel/useBroadcastChannel.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\n\n/** The use broadcast channel return type */\nexport interface UseBroadcastChannelReturn<Data = unknown> {\n  /** The underlying BroadcastChannel instance if supported, undefined otherwise */\n  channel?: BroadcastChannel;\n  /** Whether the channel has been closed */\n  closed: boolean;\n  /** The most recently received data from other contexts */\n  data?: Data;\n  /** Error object if any error occurred during channel operations */\n  error?: Event;\n  /** Whether the BroadcastChannel API is supported in the current environment */\n  supported: boolean;\n  /** Function to close the channel and clean up resources */\n  close: () => void;\n  /** Function to send data to other contexts through the channel */\n  post: (data: Data) => void;\n}\n\n/**\n * @name useBroadcastChannel\n * @description Hook that provides cross-tab/window communication\n * @category Browser\n *\n * @browserapi BroadcastChannel https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel\n *\n * @param {string} name The name of the channel\n * @param {Function} callback A callback function that will be called when a message is received\n * @returns {UseBroadcastChannelReturn} An object containing the channel state and controls\n *\n * @example\n * const { supported, data, post, error } = useBroadcastChannel('channel');\n */\nexport const useBroadcastChannel = <Data = unknown>(\n  name: string,\n  callback?: (data: Data) => void\n): UseBroadcastChannelReturn<Data> => {\n  const supported = typeof window !== 'undefined' && 'BroadcastChannel' in window;\n\n  const [closed, setClosed] = useState(false);\n  const [data, setData] = useState<Data>();\n  const [error, setError] = useState<MessageEvent>();\n  const channelRef = useRef<BroadcastChannel>(undefined);\n\n  useEffect(() => {\n    if (!supported) return;\n\n    channelRef.current = new BroadcastChannel(name);\n\n    const onMessage = (event: MessageEvent) => {\n      setData(event.data);\n      callback?.(event.data);\n    };\n    const onMessageError = (event: MessageEvent) => setError(event);\n    const onClose = () => setClosed(true);\n\n    channelRef.current.addEventListener('message', onMessage);\n    channelRef.current.addEventListener('messageerror', onMessageError);\n    channelRef.current.addEventListener('close', onClose);\n\n    return () => {\n      if (channelRef.current) {\n        channelRef.current.removeEventListener('message', onMessage);\n        channelRef.current.removeEventListener('messageerror', onMessageError);\n        channelRef.current.removeEventListener('close', onClose);\n        channelRef.current.close();\n      }\n    };\n  }, [name]);\n\n  const post = (data: Data) => {\n    console.log('post', data, channelRef.current);\n    if (!channelRef.current) return;\n    channelRef.current.postMessage(data);\n  };\n\n  const close = () => {\n    if (!channelRef.current) return;\n    channelRef.current.close();\n    setClosed(true);\n  };\n\n  return {\n    supported,\n    channel: channelRef.current,\n    data,\n    post,\n    close,\n    error,\n    closed\n  };\n};\n"],"names":["useBroadcastChannel","name","callback","supported","closed","setClosed","useState","data","setData","error","setError","channelRef","useRef","useEffect","onMessage","event","onMessageError","onClose","post","close"],"mappings":"yGAkCaA,EAAsB,CACjCC,EACAC,IACoC,CACpC,MAAMC,EAAY,OAAO,OAAW,KAAe,qBAAsB,OAEnE,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAS,EAAK,EACpC,CAACC,EAAMC,CAAO,EAAIF,WAAA,EAClB,CAACG,EAAOC,CAAQ,EAAIJ,WAAA,EACpBK,EAAaC,EAAAA,OAAyB,MAAS,EAErDC,EAAAA,UAAU,IAAM,CACd,GAAI,CAACV,EAAW,OAEhBQ,EAAW,QAAU,IAAI,iBAAiBV,CAAI,EAE9C,MAAMa,EAAaC,GAAwB,CACzCP,EAAQO,EAAM,IAAI,EAClBb,IAAWa,EAAM,IAAI,CAAA,EAEjBC,EAAkBD,GAAwBL,EAASK,CAAK,EACxDE,EAAU,IAAMZ,EAAU,EAAI,EAEpC,OAAAM,EAAW,QAAQ,iBAAiB,UAAWG,CAAS,EACxDH,EAAW,QAAQ,iBAAiB,eAAgBK,CAAc,EAClEL,EAAW,QAAQ,iBAAiB,QAASM,CAAO,EAE7C,IAAM,CACPN,EAAW,UACbA,EAAW,QAAQ,oBAAoB,UAAWG,CAAS,EAC3DH,EAAW,QAAQ,oBAAoB,eAAgBK,CAAc,EACrEL,EAAW,QAAQ,oBAAoB,QAASM,CAAO,EACvDN,EAAW,QAAQ,MAAA,EACrB,CACF,EACC,CAACV,CAAI,CAAC,EAET,MAAMiB,EAAQX,GAAe,CAC3B,QAAQ,IAAI,OAAQA,EAAMI,EAAW,OAAO,EACvCA,EAAW,SAChBA,EAAW,QAAQ,YAAYJ,CAAI,CAAA,EAG/BY,EAAQ,IAAM,CACbR,EAAW,UAChBA,EAAW,QAAQ,MAAA,EACnBN,EAAU,EAAI,EAAA,EAGhB,MAAO,CACL,UAAAF,EACA,QAASQ,EAAW,QACpB,KAAAJ,EACA,KAAAW,EACA,MAAAC,EACA,MAAAV,EACA,OAAAL,CAAA,CAEJ"}